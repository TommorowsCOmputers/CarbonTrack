{"version":3,"names":["_reactNative","require","_constants","_NativeError","_GoogleMobileAdsNativeEventEmitter","_SharedEventEmitter","_common","NATIVE_MODULE_REGISTRY","NATIVE_MODULE_EVENT_SUBSCRIPTIONS","nativeModuleKey","module","_customUrlOrRegion","app","name","_config","namespace","nativeModuleMethodWrapped","method","argToPrepend","args","possiblePromise","then","jsStack","Error","stack","catch","nativeError","Promise","reject","NativeError","nativeModuleWrapped","NativeModule","native","properties","Object","keys","i","len","length","property","isFunction","initialiseNativeModule","config","key","nativeEvents","nativeModuleName","multiModuleRoot","multiModule","Array","isArray","nativeModuleNames","nativeModule","NativeModules","getMissingModuleHelpText","assign","subscribeToNativeModuleEvent","freeze","eventName","GoogleMobileAdsNativeEventEmitter","addListener","event","appName","SharedEventEmitter","emit","snippet","charAt","toUpperCase","slice","Platform","OS","rnPackage","newInstance","getNativeModule","getAppModule","APP_NATIVE_MODULE"],"sources":["nativeModule.ts"],"sourcesContent":["/*\n * Copyright (c) 2016-present Invertase Limited & Contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this library except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport { NativeModules, Platform } from 'react-native';\nimport { APP_NATIVE_MODULE } from '../constants';\nimport { NativeError } from '../NativeError';\nimport { GoogleMobileAdsNativeEventEmitter } from '../GoogleMobileAdsNativeEventEmitter';\nimport { SharedEventEmitter } from '../SharedEventEmitter';\nimport { isFunction } from '../../common';\nimport { ModuleInterface } from '../../types/Module.interface';\n\nconst NATIVE_MODULE_REGISTRY: Record<string, unknown> = {};\nconst NATIVE_MODULE_EVENT_SUBSCRIPTIONS: Record<string, unknown> = {};\n\nfunction nativeModuleKey(module: ModuleInterface) {\n  return `${module._customUrlOrRegion || ''}:${module.app.name}:${module._config.namespace}`;\n}\n\n/**\n * Wraps a native module method to provide\n * auto prepended args and custom Error classes.\n *\n * @param namespace\n * @param method\n * @param argToPrepend\n * @returns {Function}\n */\nfunction nativeModuleMethodWrapped(\n  namespace: string,\n  method: (...args: unknown[]) => Promise<unknown> | void,\n  argToPrepend: [],\n) {\n  return (...args: []) => {\n    const possiblePromise = method(...[...argToPrepend, ...args]);\n\n    if (possiblePromise && possiblePromise.then) {\n      const jsStack = new Error().stack || '';\n      return possiblePromise.catch(nativeError =>\n        Promise.reject(new NativeError(nativeError, jsStack, namespace)),\n      );\n    }\n\n    return possiblePromise;\n  };\n}\n\n/**\n * Prepends all arguments in prependArgs to all native method calls\n *\n * @param namespace\n * @param NativeModule\n * @param argToPrepend\n */\nfunction nativeModuleWrapped(\n  namespace: string,\n  NativeModule: Record<string, (...args: unknown[]) => Promise<unknown> | void>,\n  argToPrepend: [],\n) {\n  const native: Record<string, unknown> = {};\n  if (!NativeModule) {\n    return NativeModule;\n  }\n\n  const properties = Object.keys(NativeModule);\n\n  for (let i = 0, len = properties.length; i < len; i++) {\n    const property = properties[i];\n    if (isFunction(NativeModule[property])) {\n      native[property] = nativeModuleMethodWrapped(namespace, NativeModule[property], argToPrepend);\n    } else {\n      native[property] = NativeModule[property];\n    }\n  }\n\n  return native;\n}\n\n/**\n * Initialises and wraps all the native module methods.\n *\n * @param module\n * @returns {*}\n */\nfunction initialiseNativeModule(module: ModuleInterface) {\n  const config = module._config;\n  const key = nativeModuleKey(module);\n  const { namespace, nativeEvents, nativeModuleName } = config;\n  const multiModuleRoot: Record<string, unknown> = {};\n  const multiModule = Array.isArray(nativeModuleName);\n  const nativeModuleNames = multiModule ? nativeModuleName : [nativeModuleName];\n\n  for (let i = 0; i < nativeModuleNames.length; i++) {\n    const nativeModule = NativeModules[nativeModuleNames[i]];\n\n    // only error if there's a single native module\n    // as multi modules can mean some are optional\n    if (!multiModule && !nativeModule) {\n      throw new Error(getMissingModuleHelpText(namespace));\n    }\n\n    if (multiModule) {\n      multiModuleRoot[nativeModuleNames[i]] = !!nativeModule;\n    }\n\n    Object.assign(multiModuleRoot, nativeModuleWrapped(namespace, nativeModule, []));\n  }\n\n  if (nativeEvents && nativeEvents.length) {\n    for (let i = 0, len = nativeEvents.length; i < len; i++) {\n      subscribeToNativeModuleEvent(nativeEvents[i]);\n    }\n  }\n\n  Object.freeze(multiModuleRoot);\n\n  NATIVE_MODULE_REGISTRY[key] = multiModuleRoot;\n\n  return NATIVE_MODULE_REGISTRY[key];\n}\n\n/**\n * Subscribe to a native event for js side distribution by appName\n *    React Native events are hard set at compile - cant do dynamic event names\n *    so we use a single event send it to js and js then internally can prefix it\n *    and distribute dynamically.\n *\n * @param eventName\n * @private\n */\nfunction subscribeToNativeModuleEvent(eventName: string) {\n  if (!NATIVE_MODULE_EVENT_SUBSCRIPTIONS[eventName]) {\n    GoogleMobileAdsNativeEventEmitter.addListener(eventName, event => {\n      if (event.appName) {\n        // native event has an appName property - auto prefix and internally emit\n        SharedEventEmitter.emit(`${event.appName}-${eventName}`, event);\n      } else {\n        // standard event - no need to prefix\n        SharedEventEmitter.emit(eventName, event);\n      }\n    });\n\n    NATIVE_MODULE_EVENT_SUBSCRIPTIONS[eventName] = true;\n  }\n}\n\n/**\n * Help text for integrating the native counter parts for each module.\n *\n * @param namespace\n * @returns {string}\n */\nfunction getMissingModuleHelpText(namespace: string) {\n  const snippet = `${namespace}()`;\n  const nativeModule = namespace.charAt(0).toUpperCase() + namespace.slice(1);\n\n  if (Platform.OS === 'ios') {\n    return (\n      `You attempted to use a module that's not installed natively on your iOS project by calling ${snippet}.` +\n      '\\r\\n\\r\\nEnsure you have either linked the module or added it to your projects Podfile.' +\n      '\\r\\n\\r\\nSee http://invertase.link/ios for full setup instructions.'\n    );\n  }\n\n  const rnPackage = `'io.invertase.${namespace}.ReactNative${nativeModule}Package'`;\n  const newInstance = `'new ReactNative${nativeModule}Package()'`;\n\n  return (\n    `You attempted to use a module that's not installed on your Android project by calling ${snippet}.` +\n    `\\r\\n\\r\\nEnsure you have:\\r\\n\\r\\n1) imported the ${rnPackage} module in your 'MainApplication.java' file.\\r\\n\\r\\n2) Added the ` +\n    `${newInstance} line inside of the RN 'getPackages()' method list.` +\n    '\\r\\n\\r\\nSee http://invertase.link/android for full setup instructions.'\n  );\n}\n\n/**\n * Gets a wrapped native module instance for the provided module.\n * Will attempt to create a new instance if non previously created.\n *\n * @param module\n * @returns {*}\n */\nexport function getNativeModule(module: ModuleInterface) {\n  const key = nativeModuleKey(module);\n\n  if (NATIVE_MODULE_REGISTRY[key]) {\n    return NATIVE_MODULE_REGISTRY[key];\n  }\n\n  return initialiseNativeModule(module);\n}\n\n/**\n * Custom wrapped app module as it does not have it's own FirebaseModule based class.\n *\n * @returns {*}\n */\nexport function getAppModule() {\n  if (NATIVE_MODULE_REGISTRY[APP_NATIVE_MODULE]) {\n    return NATIVE_MODULE_REGISTRY[APP_NATIVE_MODULE];\n  }\n\n  const namespace = 'app';\n  const nativeModule = NativeModules[APP_NATIVE_MODULE];\n\n  if (!nativeModule) {\n    throw new Error(getMissingModuleHelpText(namespace));\n  }\n\n  NATIVE_MODULE_REGISTRY[APP_NATIVE_MODULE] = nativeModuleWrapped(namespace, nativeModule, []);\n\n  return NATIVE_MODULE_REGISTRY[APP_NATIVE_MODULE];\n}\n"],"mappings":"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","ignoreList":[]}