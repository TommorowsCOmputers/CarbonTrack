{"version":3,"names":["_common","require","_NativeError","_AdEventType","_RewardedAdEventType","_GAMAdEventType","_validateAdShowOptions","_defineProperty","e","r","t","_toPropertyKey","Object","defineProperty","value","enumerable","configurable","writable","i","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","MobileAd","constructor","type","googleMobileAds","requestId","adUnitId","requestOptions","_type","_googleMobileAds","_requestId","_adUnitId","_requestOptions","_loaded","_isLoadCalled","_adEventsListeners","Map","_adEventListenersMap","values","AdEventType","RewardedAdEventType","GAMAdEventType","_","LOADED","forEach","set","_adEventListenerId","_adEventsListenerId","_nativeListener","emitter","addListener","_handleAdEvent","bind","event","error","data","body","CLOSED","payload","NativeError","fromEvent","listener","_getAdEventListeners","_addAdEventsListener","isFunction","Error","_className","id","delete","_addAdEventListener","isOneOf","get","name","_camelCaseType","load","native","show","showOptions","options","validateAdShowOptions","message","removeAllListeners","clear","map","loaded","exports"],"sources":["MobileAd.ts"],"sourcesContent":["/*\n * Copyright (c) 2016-present Invertase Limited & Contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this library except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport { EmitterSubscription } from 'react-native';\nimport { isFunction, isOneOf } from '../common';\nimport { NativeError } from '../internal/NativeError';\nimport { AdEventType } from '../AdEventType';\nimport { RewardedAdEventType } from '../RewardedAdEventType';\nimport { AdEventListener, AdEventPayload } from '../types/AdEventListener';\nimport { AdEventsListener } from '../types/AdEventsListener';\nimport { AdShowOptions } from '../types/AdShowOptions';\nimport { RequestOptions } from '../types/RequestOptions';\nimport { MobileAdInterface } from '../types/MobileAd.interface';\nimport { MobileAdsModuleInterface } from '../types/MobileAdsModule.interface';\nimport { RewardedAdReward } from '../types/RewardedAdReward';\nimport { GAMAdEventType } from '../GAMAdEventType';\nimport { AppEvent } from '../types/AppEvent';\nimport { validateAdShowOptions } from '../validateAdShowOptions';\n\ntype EventType = AdEventType | RewardedAdEventType | GAMAdEventType;\n\nexport abstract class MobileAd implements MobileAdInterface {\n  protected _type: 'app_open' | 'interstitial' | 'rewarded' | 'rewarded_interstitial';\n  protected _googleMobileAds: MobileAdsModuleInterface;\n  protected _requestId: number;\n  protected _adUnitId: string;\n  protected _requestOptions: RequestOptions;\n  protected _loaded: boolean;\n  protected _isLoadCalled: boolean;\n  protected _adEventsListeners: Map<number, AdEventsListener<EventType>>;\n  protected _adEventListenersMap: Map<EventType, Map<number, AdEventListener<EventType>>>;\n  protected _adEventsListenerId: number;\n  protected _adEventListenerId: number;\n  protected _nativeListener: EmitterSubscription;\n\n  protected constructor(\n    type: 'app_open' | 'interstitial' | 'rewarded' | 'rewarded_interstitial',\n    googleMobileAds: MobileAdsModuleInterface,\n    requestId: number,\n    adUnitId: string,\n    requestOptions: RequestOptions,\n  ) {\n    this._type = type;\n    this._googleMobileAds = googleMobileAds;\n    this._requestId = requestId;\n    this._adUnitId = adUnitId;\n    this._requestOptions = requestOptions;\n\n    this._loaded = false;\n    this._isLoadCalled = false;\n    this._adEventsListeners = new Map();\n    this._adEventListenersMap = new Map();\n    Object.values({\n      ...AdEventType,\n      ...RewardedAdEventType,\n      ...GAMAdEventType,\n      _: AdEventType.LOADED, // since AdEventType.LOADED is overwritten by RewardedAdEventType.LOADED\n    }).forEach(type => {\n      this._adEventListenersMap.set(type as EventType, new Map());\n    });\n    this._adEventListenerId = 0;\n    this._adEventsListenerId = 0;\n\n    this._nativeListener = googleMobileAds.emitter.addListener(\n      `google_mobile_ads_${type}_event:${adUnitId}:${requestId}`,\n      this._handleAdEvent.bind(this),\n    );\n  }\n\n  protected _handleAdEvent(event: {\n    body: {\n      type: EventType;\n      error?: { code: string; message: string };\n      data?: RewardedAdReward | AppEvent;\n    };\n  }) {\n    const { type, error, data } = event.body;\n\n    if (type === AdEventType.LOADED || type === RewardedAdEventType.LOADED) {\n      this._loaded = true;\n    }\n\n    if (type === AdEventType.CLOSED) {\n      this._loaded = false;\n      this._isLoadCalled = false;\n    }\n\n    let payload: AdEventPayload<EventType> = data;\n    if (error) {\n      payload = NativeError.fromEvent(error, 'googleMobileAds');\n    }\n    this._adEventsListeners.forEach(listener => {\n      listener({\n        type,\n        payload,\n      });\n    });\n    this._getAdEventListeners(type).forEach(listener => {\n      listener(payload);\n    });\n  }\n\n  protected _addAdEventsListener<T extends EventType>(listener: AdEventsListener<T>) {\n    if (!isFunction(listener)) {\n      throw new Error(`${this._className}.addAdEventsListener(*) 'listener' expected a function.`);\n    }\n\n    const id = this._adEventsListenerId++;\n    this._adEventsListeners.set(id, listener as AdEventsListener<EventType>);\n    return () => {\n      this._adEventsListeners.delete(id);\n    };\n  }\n\n  protected _addAdEventListener<T extends EventType>(type: T, listener: AdEventListener<T>) {\n    if (\n      !(\n        isOneOf(type, Object.values(AdEventType)) ||\n        (isOneOf(type, Object.values(RewardedAdEventType)) &&\n          (this._type === 'rewarded' || this._type === 'rewarded_interstitial'))\n      )\n    ) {\n      throw new Error(\n        `${this._className}.addAdEventListener(*) 'type' expected a valid event type value.`,\n      );\n    }\n    if (!isFunction(listener)) {\n      throw new Error(\n        `${this._className}.addAdEventListener(_, *) 'listener' expected a function.`,\n      );\n    }\n\n    const id = this._adEventListenerId++;\n    this._getAdEventListeners(type).set(id, listener);\n    return () => {\n      this._getAdEventListeners(type).delete(id);\n    };\n  }\n\n  protected _getAdEventListeners<T extends EventType>(type: T) {\n    return this._adEventListenersMap.get(type) as Map<number, AdEventListener<T>>;\n  }\n\n  protected get _className() {\n    return this.constructor.name;\n  }\n\n  protected get _camelCaseType() {\n    let type: 'appOpen' | 'interstitial' | 'rewarded' | 'rewardedInterstitial';\n    if (this._type === 'app_open') {\n      type = 'appOpen';\n    } else if (this._type === 'rewarded_interstitial') {\n      type = 'rewardedInterstitial';\n    } else {\n      type = this._type;\n    }\n    return type;\n  }\n\n  public load() {\n    // Prevent multiple load calls\n    if (this._loaded || this._isLoadCalled) {\n      return;\n    }\n\n    this._isLoadCalled = true;\n    const load = this._googleMobileAds.native[`${this._camelCaseType}Load`];\n    load(this._requestId, this._adUnitId, this._requestOptions);\n  }\n\n  public show(showOptions?: AdShowOptions) {\n    if (!this._loaded) {\n      throw new Error(\n        `${this._className}.show() The requested ${this._className} has not loaded and could not be shown.`,\n      );\n    }\n\n    let options;\n    try {\n      options = validateAdShowOptions(showOptions);\n    } catch (e) {\n      if (e instanceof Error) {\n        throw new Error(`${this._className}.show(*) ${e.message}.`);\n      } else {\n        throw e;\n      }\n    }\n\n    const show = this._googleMobileAds.native[`${this._camelCaseType}Show`];\n    return show(this._requestId, this._adUnitId, options);\n  }\n\n  public abstract addAdEventsListener<T extends never>(listener: AdEventsListener<T>): () => void;\n\n  public abstract addAdEventListener<T extends never>(type: T, listener: AdEventListener<T>): void;\n\n  public removeAllListeners() {\n    this._adEventsListeners.clear();\n    this._adEventListenersMap.forEach((_, type, map) => {\n      map.set(type, new Map());\n    });\n  }\n\n  public get adUnitId() {\n    return this._adUnitId;\n  }\n\n  public get loaded() {\n    return this._loaded;\n  }\n}\n"],"mappings":"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","ignoreList":[]}